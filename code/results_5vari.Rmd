---
title: "resulst_5vari"
author: "Jack"
date: "2023-02-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(readxl)
allsites4a <- read_excel("~/Documents/R/hons_local_r/allsites4a.xlsx")
View(allsites4a) 
```


```{r}
glimpse(allsites4a)
```
```{r}
class(allsites4a$ID)
```

#is character change to 

```{r}
unique(allsites4a$ID)
```

#change ID to factor 

```{r}
allsites4a$ID <- as.factor(allsites4a$ID)
```


```{r}
class(allsites4a$ID)
```

#now ID is factor

```{r}
levels(allsites4a$ID)
```
#i.e no order in sites as factor 

#missing data- will exclude na values as na don't mean anything for this data as tri or height difference can't be na it would be 0 or -0.1 etc.

```{r}
canopy_nar <- na.omit(allsites4a)
```

```{r}
length(canopy_nar$ID)
```
#i.e 399997 results so 3 na values removed (also shows good quality data as very little na values)


```{r}
mean(canopy_nar$tri)
```
#i.e 0.4691957 getting real values now 


```{r}
canopy_nar %>%
  ggplot(aes(x=canopy_diff, y=tri)) +
  geom_point()
```

```{r}
canopy_nar %>%
  ggplot(aes(x=dem_error, y=tri)) +
  geom_point()
```

```{r}
canopy_nar %>%
  ggplot(aes(x=fpc_diff, y=tri)) +
  geom_point()
```


```{r}
summary(canopy_nar$tri)
```
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#0.1115  0.4104  0.4857  0.4692  0.5458  0.8814 

```{r}
summary(canopy_nar$canopy_diff)
```
#Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#-67.235   0.000   0.008   1.485   1.241  63.903 


```{r}
summary(canopy_nar$fpc_diff)
```
# Min.  1st Qu.   Median     Mean  3rd Qu.     Max. 
#-100.000    0.000    0.000    1.648    1.000  100.000 

```{r}
summary(canopy_nar$avg_1st_return)
```
# Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
# 0.000   1.111   1.444   1.975   2.222  26.889 

```{r}
summary(canopy_nar$dem_error)
```
#Min.   1st Qu.    Median      Mean   3rd Qu.      Max. 
#-65.49298  -0.04504   0.09900   0.02319   0.16901 221.08600 



```{r}
std <- function(x) sd(x)/sqrt(length(x))
```

```{r}
std(canopy_nar$dem_error )
```
#sd canopy_nar$dem_error 0.003433617

```{r}
print(sqrt(sum((canopy_nar$dem_error - mean(canopy_nar$dem_error)) ^ 2/(length(canopy_nar$dem_error) - 1)))
      /sqrt(length(canopy_nar$dem_error)))
```
#se other method  canopy_nar$dem_error  0.003433617

```{r}
std(canopy_nar$avg_1st_return )
```
#canopy_nar$avg_1st_return )

```{r}
std(canopy_nar$fpc_diff )
```
#0.01605804


```{r}
std(canopy_nar$canopy_diff )
```
#0.006836824


```{r}
std(canopy_nar$tri )
```
#0.0001905845




```{r}
hist(canopy_nar$tri, xlab = "tri", main = NULL)
```
```{r}
hist(canopy_nar$avg_1st_return, xlab = "avg_1st_return", main = NULL)
```

```{r}
hist(canopy_nar$fpc_diff, xlab = "fpc_diff", main = NULL)
```

```{r}
hist(canopy_nar$canopy_diff, xlab = "canopy_diff", main = NULL)
```

```{r}
hist(canopy_nar$dem_error, xlab = "dem_error", main = NULL)

```

```{r}
canopy_nar %>%
  ggplot(aes(x=avg_1st_return, y=tri)) +
  geom_point()
```
#lid 2 avg 1st return, filter say tri at 0.1 = low error in dme or fpc, or camopy, then high say 0.8 = mabye mroe error
#then a multivariate way of displaying
#mabye hex method 
```{r}
lidarovlbara_Merge_TableToExcel <- read_excel("~/Documents/R/hons_local_r/update/v2/lidarovlbara_Merge_TableToExcel.xlsx")
```


```{r}
unique(lidarovlbara_Merge_TableToExcel$ID)
```

```{r}
lidarovlbara_Merge_TableToExcel$ID <- as.factor(lidarovlbara_Merge_TableToExcel$ID)
```

```{r}
class(lidarovlbara_Merge_TableToExcel$ID)
```

```{r}
canopy_nar_update <- na.omit(lidarovlbara_Merge_TableToExcel)
```

```{r}
std(canopy_nar_update$dem_error )
```
```{r}
levels(canopy_nar_update$ID) <- c('Baradine', 'Goondiwindi', 'Gwabegar', 'Katoomba')
```


```{r}
ggplot(canopy_nar_update, aes(x = fpcdiff_1, y = tri_1, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between TRI and FPC Error") +
  xlab("FPC Error (m)") + ylab("TRI")+
  labs(color = "Study Area")                     
  
  
```

#export values
```{r}
write.csv(canopy_nar_update2, "~/Documents/R/git/hons/terrain_roughness/data/file dame2.csv", row.names=FALSE)
```


#now use update6factorsdata2

```{r}
ggplot(update6factorsdata2, aes(x = dem_error, y = tri_1, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between TRI and DEM Error") +
  xlab("DEM Error (m)") + ylab("TRI")+
  labs(color = "Study Area")    
```
```{r}
ggplot(update6factorsdata2, aes(x = canopy_diff_1, y = tri_1, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between TRI and Canopy Error") +
  xlab("Canopy Error (m)") + ylab("TRI")+
  labs(color = "Study Area")  
```
#now compare lid2 diff
```{r}
ggplot(update6factorsdata2, aes(x = canopy_diff_1, y = lid2avgfirstreturn, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between LiDAR 2 Average First Return and Canopy Error") +
  xlab("Canopy Error (m)") + ylab("LiDAR 2 Average First Return")+
  labs(color = "Study Area")  
```

```{r}
ggplot(update6factorsdata2, aes(x = dem_error, y = lid2avgfirstreturn, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between LiDAR 2 Average First Return and DEM Error") +
  xlab("DEM Error (m)") + ylab("LiDAR 2 Average First Return")+
  labs(color = "Study Area") 
```

```{r}
ggplot(update6factorsdata2, aes(x = fpcdiff_1, y = lid2avgfirstreturn, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between LiDAR 2 Average First Return and FPC Error") +
  xlab("FPC Error (m)") + ylab("LiDAR 2 Average First Return")+
  labs(color = "Study Area")  
```



#now without kat data
```{r}
unique(update6factorsdata2)
```


```{r}
unique(nokatdata$ID)
```
#no kat 

```{r}
ggplot(nokatdata, aes(x = dem_error, y = lid2avgfirstreturn, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between LiDAR 2 Average First Return and DEM Error") +
  xlab("DEM Error (m)") + ylab("LiDAR 2 Average First Return")+
  labs(color = "Study Area") 
```

```{r}
ggplot(nokatdata, aes(x = canopy_diff_1, y = lid2avgfirstreturn, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between LiDAR 2 Average First Return and Canopy Error") +
  xlab("Canopy Error (m)") + ylab("LiDAR 2 Average First Return")+
  labs(color = "Study Area")  
```


```{r}
ggplot(nokatdata, aes(x = fpcdiff_1, y = lid2avgfirstreturn, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between LiDAR 2 Average First Return and FPC Error") +
  xlab("FPC Error (m)") + ylab("LiDAR 2 Average First Return")+
  labs(color = "Study Area")  
```

#now density 
```{r}
ggplot(update6factorsdata2, aes(x=dem_error, y=tri_1) ) +
  geom_bin2d(bins = 70) +
  scale_fill_continuous(type = "viridis") +
  theme_bw()
```
```{r}
ggplot(update6factorsdata2, aes(x=dem_error, y=tri_1) ) +
  geom_hex(bins = 70) +
  scale_fill_continuous(type = "viridis") +
  theme_bw()+
  ggtitle("Relationship between TRI and DEM Error") +
  xlab("DEM Error (m)") + ylab("TRI")+
  geom_smooth(method=lm, color="brown2")
```


```{r}
ggplot(update6factorsdata2, aes(x=dem_error, y=tri_1)) +
  stat_density_2d(aes(fill = ..density..), geom = "raster", contour = FALSE) +
  scale_x_continuous(expand = c(0, 0)) +
  scale_y_continuous(expand = c(0, 0)) +
  theme(
    legend.position='none'
  )
```
# not very interesting ^

```{r}
ggplot(update6factorsdata2, aes(x=dem_error, y=tri_1) ) +
  stat_density_2d(aes(fill = ..level..), geom = "polygon", colour="white")+
  ggtitle("Relationship between TRI and DEM Error") +
  xlab("DEM Error (m)") + ylab("TRI")
```

```{r}
ggplot(update6factorsdata2, aes(x=canopy_diff_1, y=tri_1) ) +
  geom_hex(bins = 70) +
  scale_fill_continuous(type = "viridis") +
  theme_bw()+
  ggtitle("Relationship between TRI and Canopy Error") +
  xlab("Canopy Error (m)") + ylab("TRI")+
  geom_smooth(method=lm, color="brown2")
```
```{r}

ggplot(update6factorsdata2, aes(x=fpcdiff_1, y=tri_1) ) +
  geom_hex(bins = 70) +
  scale_fill_continuous(type = "viridis") +
  theme_bw()+
  ggtitle("Relationship between TRI and FPC Error") +
  xlab("FPC Error (m)") + ylab("TRI")+
  geom_smooth(method=lm, color="brown2")
```


```{r}
ggplot(update6factorsdata2, aes(x=fpcdiff_1, y=lid2avgfirstreturn) ) +
  geom_hex(bins = 70) +
  scale_fill_continuous(type = "viridis") +
  theme_bw()+
  ggtitle("Relationship between LiDAR 2 Average First Return and FPC Error") +
  xlab("FPC Error (m)") + ylab("LiDAR 2 Average First Return")+
  geom_smooth(method=lm, color="brown2")
```

```{r}
ggplot(update6factorsdata2, aes(x=canopy_diff_1, y=lid2avgfirstreturn) ) +
  geom_hex(bins = 70) +
  scale_fill_continuous(type = "viridis") +
  theme_bw()+
  ggtitle("Relationship between LiDAR 2 Average First Return and Canopy Error") +
  xlab("Canopy Error (m)") + ylab("LiDAR 2 Average First Return")+
  geom_smooth(method=lm, color="brown2")
```

```{r}
ggplot(update6factorsdata2, aes(x=dem_error, y=lid2avgfirstreturn) ) +
  geom_hex(bins = 70) +
  scale_fill_continuous(type = "viridis") +
  theme_bw()+
  ggtitle("Relationship between LiDAR 2 Average First Return and DEM Error") +
  xlab("DEM Error (m)") + ylab("LiDAR 2 Average First Return")+
  geom_smooth(method=lm, color="brown2")
```
#now boxplot of dem error by site
```{r}
ggplot(update6factorsdata2, aes(x=ID, y=dem_error, fill=ID)) + 
    geom_boxplot(lwd=0.8)+ 
  theme(legend.position="none")
```

```{r}
ggplot(update6factorsdata2, aes(x=ID, y=dem_error, fill=ID)) +
geom_violin()+
  ggtitle("Distribution of DEM Error between Study Areas") +
  ylab("DEM Error (m)") + xlab("Study Areas")+
  theme(legend.position="none")
```

```{r}
ggplot(update6factorsdata2, aes(x=ID, y=dem_error, fill=ID)) + 
    geom_boxplot(alpha=0.3)+
  theme(legend.position="none")+
  scale_fill_brewer(palette="BuPu")+
  ggtitle("Distribution of DEM Error between Study Areas") +
  ylab("DEM Error (m)") + xlab("Study Areas")
```
#with no kat
```{r}
ggplot(nokatdata, aes(x=ID, y=dem_error, fill=ID)) + 
    geom_boxplot(alpha=0.3)+
  theme(legend.position="none")+
  scale_fill_brewer(palette="BuPu")+
  ggtitle("Distribution of DEM Error between Study Areas") +
  ylab("DEM Error (m)") + xlab("Study Areas")
```
```{r}
ggplot(nokatdata, aes(x=ID, y=dem_error, fill=ID)) +
geom_violin()+
  ggtitle("Distribution of DEM Error between Study Areas") +
  ylab("DEM Error (m)") + xlab("Study Areas")+
  theme(legend.position="none")
```
```{r}
ggplot(update6factorsdata2, aes(x=ID, y=fpcdiff_1, fill=ID)) + 
    geom_violin()+
  ggtitle("Distribution of FPC Error between Study Areas") +
  ylab("FPC Error (m)") + xlab("Study Areas")+
  theme(legend.position="none")
```

```{r}
ggplot(update6factorsdata2, aes(x=ID, y=fpcdiff_1, fill=ID)) + 
    geom_boxplot()+
  ggtitle("Distribution of FPC Error between Study Areas") +
  ylab("FPC Error (m)") + xlab("Study Areas")+
  theme(legend.position="none")
```





```{r}
ggplot(update6factorsdata2, aes(x=ID, y=canopy_diff_1, fill=ID)) + 
    geom_boxplot()+
  ggtitle("Distribution of Canopy Error between Study Areas") +
  ylab("Canopy Error (m)") + xlab("Study Areas")+
  theme(legend.position="none")
```
```{r}
ggplot(update6factorsdata2, aes(x=ID, y=canopy_diff_1, fill=ID)) + 
    geom_violin()+
  ggtitle("Distribution of Canopy Error between Study Areas") +
  ylab("Canopy Error (m)") + xlab("Study Areas")+
  theme(legend.position="none")

```
#TRI vs error.

```{r}
hist(update6factorsdata2$lid2avgfirstreturn, breaks = 7, xlab = "lid2avgfirstreturn", main = NULL)
```
```{r}
summary(update6factorsdata2$lid2avgfirstreturn)
```
# Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
#0.0000  0.2222  0.3333  0.3534  0.4444 15.3333 

```{r}
ggplot(data = update6factorsdata2, mapping = aes(x=lid2avgfirstreturn)) + 
  geom_histogram(aes(y=..density..),fill="bisque",color="white",alpha=0.7) + 
  geom_density() +
  geom_rug() +
  labs(x='lid2avgfirstreturn') +
  theme_minimal()
```
#create breaks
```{r}
breaks <- c(0,1,2,3,4,5)
```

```{r}
tags <- c("[0)","[1)", "[2)", "[3)", "[4)")
```

```{r}

```


```{r}
grouped_tags <- cut(update6factorsdata2$lid2avgfirstreturn, 
                  breaks=breaks, 
                  include.lowest=TRUE, 
                  right=FALSE,
                  labels=tags)
summary(grouped_tags)
```

#get rid of na's
```{r}
update6factorsdata2lid2 <- na.omit(update6factorsdata2)
```

```{r}
grouped_tags2 <- cut(update6factorsdata2lid2$lid2avgfirstreturn, 
                  breaks=breaks, 
                  include.lowest=TRUE, 
                  right=FALSE)
summary(grouped_tags2)
```

```{r}
lid2avg1streturn_group <- factor(grouped_tags, 
                           levels = labels,
                           ordered = TRUE)
```

```{r}
max
```


```{r}
ggplot(data = as_tibble(grouped_tags), mapping = aes(x=value)) + 
  geom_bar(fill="bisque",color="white",alpha=0.7) + 
  stat_count(geom="text", aes(label=sprintf("%.4f",..count../length(grouped_tags))), vjust=-0.5) +
  labs(x='LiDAR 2 Average First Return') +
  theme_minimal()
```
```{r}
tags <- c("[0-0.5)","[0.5-1)", "[1-1.5)", "[1.5-2)", "[2-max)")
```

```{r}
breaks <- c(0.5,1,1.5,2,2.5)
```


```{r}
v <- update6factorsdata2 %>% select(lid2avgfirstreturn,tri_1)  
vgroup <- as_tibble(v) %>% 
  mutate(tag = case_when(
    lid2avgfirstreturn < 0.5 ~ tags[0-0.5],
    lid2avgfirstreturn >= 0.5 & lid2avgfirstreturn < 1 ~ tags[0.5-1],
    lid2avgfirstreturn >= 1 & lid2avgfirstreturn < 1.5 ~ tags[1-1.5],
    lid2avgfirstreturn >= 1.5 & lid2avgfirstreturn < 2 ~ tags[1.5-2],
    lid2avgfirstreturn >= 2 & lid2avgfirstreturn < 2.5 ~ tags[2-max]
   ))
summary(vgroup)
```
```{r}
attach(update6factorsdata2)
```


```{r}
lid2group <- cut(lid2avgfirstreturn, breaks =c(0,0.5,1,1.5,2,2.5,16 ), labels =c("0-0.5","0.5-1", "1-1.5", "1.5-2", "2-2.5", "2-max" ))
```

```{r}
lid2group2 <- cut(lid2avgfirstreturn, breaks=4) 
```


```{r}
summary(lid2group)
```

```{r}
hist(as.numeric(lid2group))
```
```{r}
ggplot(data = as_tibble(lid2group), mapping = aes(x=lid2avgfirstreturn)) + 
  geom_bar()
```
```{r}
plot(lid2group)
```
```{r}
x1 <- table(lid2group)
barplot(x1[order(x1, decreasing = TRUE)])
```

```{r}

levels(lid2group)
```

```{r}
glimpse(lid2group)
```

```{r}
update6factorsdata2$lid2avgfirstreturn <- cut(update6factorsdata2$lid2avgfirstreturn,
                                              breaks = c(-Inf
                                                         ,0.5,1,1.5,2,2.5, Inf),
                                              labels =c("0-0.5","0.5-1", "1-1.5", "1.5-2", "2-2.5", "2+"),
                                              )
```
```{r}

ggplot(update6factorsdata2, aes(x=lid2avgfirstreturn, y=tri_1)) + 
    geom_boxplot()
```
```{r}
head(file_update6factorsdata22update6factorsdata2lid2)
```
```{r}
file_update6factorsdata22update6factorsdata2lid2[2,9]
```
```{r}
 lowavgval<-file_update6factorsdata22update6factorsdata2lid2[file_update6factorsdata22update6factorsdata2lid2$group =="0>0.5",]
```
#lowavgval is 0>0.5


```{r}
ggplot(lowavgval, aes(x = fpcdiff_1, y = tri_1, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between TRI and FPC Error for LiDAR 2 Average First Return 0>0.5  ") +
  xlab("FPC Error (m)") + ylab("TRI")+
  labs(color = "Study Area")   

  
```
```{r}
ggplot(lowavgval, aes(x = dem_error, y = tri_1, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between TRI and DEM Error for LiDAR 2 Average First Return 0>0.5") +
  xlab("DEM Error (m)") + ylab("TRI")+
  labs(color = "Study Area")    
```



```{r}
 lowmedavgval<-file_update6factorsdata22update6factorsdata2lid2[file_update6factorsdata22update6factorsdata2lid2$group =="0.5>1",]
```
#351 obs at 0.5>1

```{r}
ggplot(lowmedavgval, aes(x = dem_error, y = tri_1, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between TRI and DEM Error for LiDAR 2 Average First Return 0.5>1") +
  xlab("DEM Error (m)") + ylab("TRI")+
  labs(color = "Study Area") 
```
```{r}
unique(file_update6factorsdata22update6factorsdata2lid2$group)
```


```{r}
 onetoonepointfive<-file_update6factorsdata22update6factorsdata2lid2[file_update6factorsdata22update6factorsdata2lid2$group =="1>1.5",]
```

```{r}
ggplot(onetoonepointfive, aes(x = dem_error, y = tri_1, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between TRI and DEM Error for LiDAR 2 Average First Return 1>1.5") +
  xlab("DEM Error (m)") + ylab("TRI")+
  labs(color = "Study Area") 
```

```{r}
 onepoinrfivetotwo<-file_update6factorsdata22update6factorsdata2lid2[file_update6factorsdata22update6factorsdata2lid2$group =="1.5>2",]
```

```{r}
ggplot(onepoinrfivetotwo, aes(x = dem_error, y = tri_1, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between TRI and DEM Error for LiDAR 2 Average First Return 1.5>2") +
  xlab("DEM Error (m)") + ylab("TRI")+
  labs(color = "Study Area") 
```
```{r}
twototwopointfive<-file_update6factorsdata22update6factorsdata2lid2[file_update6factorsdata22update6factorsdata2lid2$group =="2>2.5",]

```

```{r}
ggplot(twototwopointfive, aes(x = dem_error, y = tri_1, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between TRI and DEM Error for LiDAR 2 Average First Return 2>2.5") +
  xlab("DEM Error (m)") + ylab("TRI")+
  labs(color = "Study Area") 
```

```{r}
twoandover<-file_update6factorsdata22update6factorsdata2lid2[file_update6factorsdata22update6factorsdata2lid2$group =="2.5>",]

```


```{r}
ggplot(twoandover, aes(x = dem_error, y = tri_1, color =ID))+
  geom_point(size=0.5, shape=20)+
  geom_smooth(method=lm, color="brown2") +
  ggtitle("Relationship between TRI and DEM Error for LiDAR 2 Average First Return 2.5>") +
  xlab("DEM Error (m)") + ylab("TRI")+
  labs(color = "Study Area") 
```

